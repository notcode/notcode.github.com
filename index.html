
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Not Code</title>
  <meta name="author" content="coder">

  
  <meta name="description" content="1. 常用的命令 pg_ctl init -D DIR -o "--no-locale" 初始化数据目录. -o表示要传递给initdb的参数. --no-locale将encoding设置为SQL_ASCII,Collation和Ctype设置为C,可以避免各种编码的问题.
pg_ctl &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://notcode.github.io">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Not Code" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Not Code</a></h1>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:notcode.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/10/14/setup-master-slave-replication-on-postgresql/">Setup Master Slave Replication on Postgresql</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-10-14T13:04:00+08:00" pubdate data-updated="true">10/14/2013</time>
        
         | <a href="/blog/2013/10/14/setup-master-slave-replication-on-postgresql/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h4>1. 常用的命令</h4>

<ul>
<li><p><code>pg_ctl init -D DIR -o "--no-locale"</code></p>

<p>初始化数据目录. <code>-o</code>表示要传递给initdb的参数. <code>--no-locale</code>将encoding设置为SQL_ASCII,Collation和Ctype设置为C,可以避免各种编码的问题.</p></li>
<li><p><code>pg_ctl start -D &lt;DATA DIR&gt; -l &lt;LOG FILE&gt;</code></p>

<p>启动pg</p></li>
<li><p><code>pg_ctl stop  -D &lt;DATA DIR&gt;</code></p>

<p>停止pg</p></li>
<li><p><code>pg_dump &lt;DBNAME&gt; [-t &lt;TBNAME&gt;]...</code></p>

<p>导出数据库/表</p></li>
</ul>


</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2013/10/14/setup-master-slave-replication-on-postgresql/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/10/13/refactor-datebase-design/">Refactor Database Design</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-10-13T19:40:00+08:00" pubdate data-updated="true">10/13/2013</time>
        
         | <a href="/blog/2013/10/13/refactor-datebase-design/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h4>原来的设计</h4>

<p>最近被临时调入一个项目，任务是重写后台计算程序, 所以要保持现有的接口和数据库设计。
原有的数据库被设计成每个task一张表，表名为<code>&lt;prefix&gt;_&lt;taskid&gt;</code>，简单说明一下:</p>

<blockquote><ul>
<li>prefix 用于区别报表类型，每个task有10多种报表类型</li>
<li>taskid 整数，用于标识task
每个task有一个开始日期和结束日期，在这个日期区间内，每天计算一次该task的报表。
每个table都有date列, 表明该行记录是哪一天的计算结果</li>
</ul>
</blockquote>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2013/10/13/refactor-datebase-design/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/10/13/write-into-database-in-mapreduce-job/">Be Careful With Mapreduce While Writing Into Database</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-10-13T10:04:00+08:00" pubdate data-updated="true">10/13/2013</time>
        
         | <a href="/blog/2013/10/13/write-into-database-in-mapreduce-job/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>A Strange Case</h3>

<p>Recently we come across a problem when writing into database in mapreduce jobs.
The job gets lots of failure attempt, though succeeds finally.
We reviewed the source code of job, nothing seemed suspicious, there must be something wrong in our cluster.</p>

<p>So we reproduce the scenario.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2013/10/13/write-into-database-in-mapreduce-job/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/09/07/replica-strategy-in-hdfs-is-not-good/">Replica Strategy in Hdfs Is Not Good Enough</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-09-07T19:02:00+08:00" pubdate data-updated="true">09/07/2013</time>
        
         | <a href="/blog/2013/09/07/replica-strategy-in-hdfs-is-not-good/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Two methods of Replica</h3>

<p>I&rsquo;ve known two methods of replica in distributed storage system.
One is like hadoop, which distributes the three replicas of a block on three different nodes.
The other is like mongodb, which store data into shardings with three nodes in each sharding.These three nodes in the same sharding are identical.</p>

<p>Both of the two strategy has a &ldquo;at most two dead node&rdquo; tolerance,that meanings if one or two node in cluster crash,all the data is still available. But what happen to three nodes?</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2013/09/07/replica-strategy-in-hdfs-is-not-good/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/08/08/mongodb-performance-tuning/">Mongodb Performance Tuning</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-08-08T09:47:00+08:00" pubdate data-updated="true">08/08/2013</time>
        
         | <a href="/blog/2013/08/08/mongodb-performance-tuning/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h4>1.背景</h4>

<p>mongodb的写性能很一般,即使采用bulk insert，也达不到我们的业务需求。
另外，mongodb有一个DB粒度的读写锁,因此采用并发写也无法提高写性能。因为读写锁的关系，在有写负载较高的情况下,读性能也被拉低了。</p>

<p>引自mongodb官网:</p>

<blockquote><p>Beginning with version 2.2, MongoDB implements locks on a per-database basis for most read and write operations.</p></blockquote>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2013/08/08/mongodb-performance-tuning/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/07/20/setup-kvm-environment-on-centos-5-dot-3/">在CentOS 5.3 中搭建kvm虚拟机</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-07-20T15:41:00+08:00" pubdate data-updated="true">07/20/2013</time>
        
         | <a href="/blog/2013/07/20/setup-kvm-environment-on-centos-5-dot-3/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>0.准备环境</h2>

<ol>
<li><p>确认cpu是否支持硬件虚拟化</p>

<pre><code>grep -o 'vmx\|svm' /proc/cpuinfo
</code></pre>

<p>如果有输出，表示cpu可以支持。intel的cpu会输出vmx，amd的cpu输出svm.</p></li>
</ol>


</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2013/07/20/setup-kvm-environment-on-centos-5-dot-3/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/07/02/modeline-vim-configuration-per-file/">Modeline: Vim Configuration Per File</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-07-02T22:10:00+08:00" pubdate data-updated="true">07/02/2013</time>
        
         | <a href="/blog/2013/07/02/modeline-vim-configuration-per-file/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>简介</h2>

<p>vim有一个叫做modeline的功能，它允许对单独的文件设置vim变量。当用vim打开文件时，这些变量便可生效。</p>

<p>当编辑python文件时，必须保证编辑环境的缩进和文件中原有的缩进一致。有多个开发人员协作时，缩进不一致的问题经常发生。
使用modeline可以解决这样的问题。</p>

<p>具体做法如下：</p>

<pre><code>#!/usr/bin/env python2.7
# vim: ts=4 sw=4 et
</code></pre>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2013/07/02/modeline-vim-configuration-per-file/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  <div class="pagination">
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/10/14/setup-master-slave-replication-on-postgresql/">Setup Master Slave Replication on Postgresql</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/10/13/refactor-datebase-design/">Refactor Database Design</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/10/13/write-into-database-in-mapreduce-job/">Be Careful With Mapreduce While Writing Into Database</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/09/07/replica-strategy-in-hdfs-is-not-good/">Replica Strategy in Hdfs Is Not Good Enough</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/08/08/mongodb-performance-tuning/">Mongodb Performance Tuning</a>
      </li>
    
  </ul>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - coder -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'garfee';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
